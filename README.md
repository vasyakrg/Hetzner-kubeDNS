# Hetzner-kubeDNS

Мой вариант прокидывания трафика на локальный куб через внешний traefik + автосоздание субдомена в Hetzner

- в endpoints указать правильные адреса нод куба
- в ингресе доменное имя, которое хотим привязать
- в external-dns - указать свой токен от провайдера, который привязывает домены и фильтр по доменам (если нужен)
- и наконец создать траефик контроллер

## Общее описание

у меня три ноды в локалке с кубом и nginx-ingress-controler
там же в локалке есть вм с traefik (в котором в конфиге подключен провайдер kubernetes)
на hezner есть домен и выпущен токен для управления записями.

задача: при запуске новой приложухи в кубе создать субдомен в хецнере, дернуть траефик, что бы он создал у себя сервис, прокинул балансер на три локальные ноды и выпустил сертификат ssl для приложухи.
по итогу: получить извне красивый доступ по субдомену в приложуху в кубе

реализация:
со стороны траефика - https://pastebin.com/smzbfbHq и https://pastebin.com/QiN13NsB
со стороны куба - https://github.com/vasyakrg/Hetzner-kubeDNS

общая логика в кубе: я создаю два сервиса и заставляю эндпоинт верить во второй
в этом случае не надо костылить чего-то типа MetallLB и прочей ереси.
в кубе не водится никаких certmanager, нет лишних телодвижений с пробросами портов.
а траефик помимо куба может мило раздавать серты и прокидывать трафик и другим сущностям. например виртуалкам в локальной сети.
